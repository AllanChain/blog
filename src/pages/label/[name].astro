---
import dataPromise from '@data'
import type { BlogPost, BlogLabel } from '@data/types'
import 'unocss-hmr-fix'
import PostCards from '@components/PostCards.astro'

export interface Props {
  label: BlogLabel
  posts: BlogPost[]
}

export async function getStaticPaths() {
  const { posts, labels } = await dataPromise
  return Object.entries(labels).map(([id, label]) => ({
    params: { name: id.replace(': ', '-') },
    props: {
      label,
      posts: posts.filter(({ labels: postLabels }) =>
        postLabels.includes(label)
      ),
    },
  }))
}

const { label, posts } = Astro.props as Props
---

<title>{label.id}</title>

<body class='bg-gray-100'>
  <h1>All posts with label `{label.id}`</h1>
  <PostCards posts={posts} />
</body>
