<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>让Termux对浏览器更友好 | AC&#39;s Blog</title>
    <link rel="stylesheet" href="https://allanchain.github.io/blog/css/style.css" />
    <link rel="stylesheet" href="https://allanchain.github.io/blog/css/fonts.css" />
    <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/solarized-dark.min.css" rel="stylesheet">

  </head>

  <body class="page">
    <nav class="header">
      <div class="banner">
<a href="https://allanchain.github.io/blog/" class="text">
&Afr;&Cfr;'&Sfr; &Bfr;&Lfr;&Ofr;&Gfr;
</a>
</div>

      <div class="head-meta">
      
        <span><a href="https://allanchain.github.io/blog/">&larr; Home</a></span>
        <span class="date">2019-07-03</span>
        
        
        
          
        
        
        
        <span><a href="https://github.com/AllanChain/blog/edit/master/content/post/TermuxWithBrowser.md">Edit &rarr;</a></span>
        
        
      
      </div>
    </nav>

<div class="container">
<article>
<div class="article-meta">

  <div class="categories">
  
    <a href="https://allanchain.github.io/blog/categories/python">Python</a>
  
  </div>

  <h1><span class="title">让Termux对浏览器更友好</span></h1>

  
  <h3 class="author">Allan Chain
</h3>
  

  
  

</div>



<main>
<p>Download <a href="xb.py">xb.py</a></p>

<p>难点：</p>

<ul>
<li><p>获取jupyter等应用的实时输出</p>

<pre><code class="language-python">import subprocess
backup = subprocess.Popen(
	cmd.split(), shell=False, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
for line in iter(backup.stdout.readline, b''):
	line = line.rstrip().decode('utf8')
</code></pre></li>

<li><p>使Ctrl+C能使让应用结束</p>

<ul>
<li><p>只有以<code>shell=False</code>启动的<code>Popen</code>才能收到中止信号，不要问我为什么。</p>

<pre><code class="language-python">try:
do_something()
except KeyboardInterrupt:
from os import _exit
    
print('Quiting')
backup.kill()
_exit(0)
</code></pre></li>
</ul></li>

<li><p>能自动识别使用什么应用</p>

<pre><code class="language-python"># 基于文件数量多少的分类

def guess_app():
from os import listdir, getcwd, chdir
from os.path import splitext

app_trait = {'.ipynb': 'j',
             '.md': 'd'}
# Support launch mkdocs even deep inside the directory
chdir(getcwd().split('docs')[0])
if 'mkdocs.yml' in listdir():
    return 'k'
exts = {}
	# Convert to only extentions
all_file = list(map(lambda x: splitext(x)[1], listdir()))
for k in app_trait:
    exts[k] = all_file.count(k)
# Get the most frequent one
most = sorted([(k, v)for k, v in exts.items()],
              key=lambda x: x[1], reverse=True)[0][0]
return app_trait[most]
</code></pre>

<pre><code class="language-python"># 参考了grip语法后，也许更合适的分类

def guess_app():
from os import listdir, getcwd, chdir
from os.path import splitext

app_trait = {'.ipynb': 'j',
             '.md': 'd'}
# Support launch mkdocs even deep inside the directory
if 'mkdocs.yml' in listdir():
    return 'k'
pwd = getcwd()
if 'docs' in pwd:
    chdir(pwd.split('docs')[0])
    if 'mkdocs.yml' in listdir():
        return 'k'
    chdir(pwd)
if len(argv) &gt; 1 and argv[1].endswith('.md') or 'README.md' in listdir():
    return 'd'
exts = {}
# Convert to only extentions
all_file = set(map(lambda x: splitext(x)[1], listdir()))
if '.ipynb' in all_file:
    return 'j'
raise NotImplementedError('No application found to implement this.')
</code></pre></li>

<li><p>有时候应用不止一次地输出应打开的地址，这时要立一个flag</p>

<pre><code class="language-python">def start_app(cmd):
XB_STATUS = False
	......
	r = findall('http://.*/', line) or findall('http://.*$', line)
	if len(r) &gt; 0 and not XB_STATUS:
		print(r[0])
		popen('termux-open-url &quot;%s&quot;' % r[0])
		XB_STATUS = True
</code></pre></li>
</ul>

</main>














<nav class="post-nav">
  <span class="nav-prev"><a href="https://allanchain.github.io/blog/post/2019/07/14/using-kivy-and-buildozer-to-build-android-apk/">&larr; Using Kivy and Buildozer to Build Android APK</a></span>
  <span class="nav-next"><a href="https://allanchain.github.io/blog/post/2019/06/10/add-ssh-key/">Add SSH Key &rarr;</a></span>
</nav>



</article>
</div>

<script async src="//yihui.name/js/center-img.js"></script>

<footer>

<div class="footer">
  <ul class="menu">
    
    <li><a href="https://allanchain.github.io/blog/"><span data-hover="Home">Home</span></a></li>
    
    <li><a href="https://allanchain.github.io/blog/about/"><span data-hover="About">About</span></a></li>
    
    <li><a href="https://allanchain.github.io/blog/categories/"><span data-hover="Categories">Categories</span></a></li>
    
    <li><a href="https://allanchain.github.io/blog/tags/"><span data-hover="Tags">Tags</span></a></li>
    
  </ul>
  
  <div class="copyright">Powered by hugo and hugo-xmag theme</div>
  
</div>
</footer>


<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script>
hljs.configure({languages: []});
hljs.initHighlightingOnLoad();
</script>




</body>
</html>

